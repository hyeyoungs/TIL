# 테스트를 해야 하는 이유
## 필요성
### 레거시 코드
> 레거시 코드란? 단순히 테스트 루틴이 없는 코드

- 테스트 코드가 없으면,
  - 정상적으로 동작하던 서비스가 이번 배포로 동작을 안해요
  - 프로젝트에 합류한지 얼마 안되서 수정이 무서운데, 제 코드 때문에 다른 코드에 영향이 있지 않을까요?
- 테스트 코드가 있으면,
  - 이번 버전은 배포해도 크게 문제 없을 것 같네요

<br>

### SOLID
- 단일 책임 원칙 : 테스트가 너무 많아져서 이게 무슨 목적의 클래스인지 눈에 안들어오는 지점이 생김<br>이 때가 `클래스를 분할해야 하는 시점, 그러면서 책임이 자연스럽게 분배 됨`
- 개방 폐쇄 원칙 : `테스트 컴포넌트와 프로덕션 컴포넌트를 나눠 작업하게 되고 필요에 따라 이 컴포넌트를 자유자재로 탈부착이 가능하게 개발하게 됨`
- 리스코프 치환 원칙 : 이상적으로 테스트는 모든 케이스에 대해 커버하고 있으므로, `서브 클래스에 대한 치환 여부를 테스트가 알아서 판단해줌`
- 인터페이스 분리 원칙 : 테스트는 그 자체로 인터페이스를 직접 사용해볼 수 있는 환경. `불필요한 의존성을 실체로 확인할 수 있는 샌드박스`
- 의존성 역전 원칙 : 가짜 객체를 이용하여 테스트를 작성하려면, 의존성이 역전되어 있어야 하는 경우가 생김

<br><br>

# 테스트에 필요한 개념
## TDD
테스트 주도 개발
1. 깨지는 테스트를 먼저 작성
2. 깨지는 테스트를 성공
3. 리팩토링

<br>

## BDD
테스트 코드를 작성하다보면 모든 메소드를 다 테스트하고 싶은 욕구가 생김
<br>메소드 위주의 테스트 코드보다 시나리오에 기반한 테스트를 하는 방식
<br>ex. # 시나리오1 <br>어떤 상황이 주어지고<br>어떤 행동을 할 때<br>이렇게 되더라.

<br>

## Mock 프레임워크
### Mock 프레임워크를 지양해야 하는 이유
🤔 UserRepository가 굳이 인터페이스이어야 할 이유가 있나? 
<br>🤨 그냥 class로 만들고 mock 프레임워크를 사용해서 필요할 때마다 stub 하면 되지 않나??

![image](https://github.com/hyeyoungs/TIL/assets/29566893/eb61ef8b-87fb-4ebb-97d1-b297ece54472)

테스트 코드를 작성하는 것 자체가 목적이 되어버리고, 그 결과 자연스러운 추상화로 유연한 설계를 얻을 기회를 놓치게 됨
### 테스트 코드의 목적
1. 회귀 버그 방지 
2. 유연한 설계

<br>

## 의존성과 테스트
의존성은 테스트를 하기 힘들게 만듦
<br> `의존성 주입 + 의존성 역전`으로 해결

<br>

## 빌더
생성자가 지나치게 많아지는 문제를 해결할 수 있는 유연한 해결책
<br>그러나, 일부 파라미터를 누락하게 하는 실수를 만들기도 함
<br>그럼에도, `테스트에 필요한 파라미터만 지정하게 하면서 테스트할 때 가독성을 높여줌`

<br> 

## 엔티티
- 도메인 엔티티 : 비즈니스 영역을 해결하는 모델
- 영속성 객체 : ORM / ODM
- DB 엔티티 : RDB에 저장되는 객체 / 도큐먼트 : Collection에 저장되는 객체

<br><br>

# 테스트 기법 소개
## 조언
### private 메소드
#### 🤔 private 메소드는 테스트 해야 할까?
No
<br>
#### 🤨 private 메소드를 테스트하고 느낌이 든다면
1. 사실 private 메소드가 아니었어야 한다는 의미이거나
2. 다른 클래스로 분리/책임을 위임해서 public으로 만들라는 의미일수도 있음

#### ✔️ 메소드 지향의 테스트 ❌ 행위에 집중해서 테스트 해야함 ⭕ ️

### final 메소드
final 메소드를 stub 해야하는 상황이 생긴다면, 무언가 설계가 잘못된 것

### DRY < DAMP
테스트와 코드 공유 : DRY(반복하지 않기)가 아니라 DAMP(서술적이고 의미 있는 문구)

![image](https://github.com/hyeyoungs/TIL/assets/29566893/7672e6cc-6474-4020-aa13-f6a7209a95b2)

### 논리
#### 테스트에 논리를 넣지 말자 (+, for, if)
버그를 찾을 수 있는가?

![image](https://github.com/hyeyoungs/TIL/assets/29566893/c980ed20-3783-4479-9cc9-f138138d5cc4)
![image](https://github.com/hyeyoungs/TIL/assets/29566893/b87eb87b-efb0-4598-89a5-1bab93f561e5)

<br>

## 기법
### 의존성 추상화
테스트 하기 어려운 의존성이 있을 떄 사용할 수 있는 기법
- 다루기 까다로운 경우 ex. Random / Time
  ![image](https://github.com/hyeyoungs/TIL/assets/29566893/b6efdc32-8f62-423e-ba90-0e0d131a3f2f)
- 테스트에 필요한 인스턴스를 생성하기 힘든 경우 ex. HttpRequest...
  ![image](https://github.com/hyeyoungs/TIL/assets/29566893/0b29c9f5-b702-4b82-9053-9c6b47c29d82)
- 재정의가 까다로운 경우 ex. final / 전역 참조
  ![image](https://github.com/hyeyoungs/TIL/assets/29566893/24a82c70-72a9-44ef-96a1-6d49035f228c)

### 이벤트 기록
테스트를 위한 getter 생성이 남발된다 싶을 때 적용할 수 있는 기법
<br>내부에 기록한 이벤트를 사용해 변경 가능 객체의 변경을 확인

![image](https://github.com/hyeyoungs/TIL/assets/29566893/146e6f64-d6bd-4cae-821f-caa11f810eb7)
![image](https://github.com/hyeyoungs/TIL/assets/29566893/c277e446-e302-4773-8395-32ab7449409f)
